(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{117:function(e,t,n){},120:function(e,t,n){},132:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),o=n(16),c=n.n(o),i=n(27),l=n(19),s=n(20),u=n(24),m=n(21),h=n(23),d=(n(116),n(117),n(7)),f=n(33),p=n(18),g=n(14),v=n(34),E=n(22),k=n.n(E),y=n(66),b=n.n(y);function w(){var e=Object(v.a)(["\n  query size($input: String) {\n    size(input: $input) {\n      price\n      nextMinute\n    }\n  }\n"]);return w=function(){return e},e}function O(){var e=Object(v.a)(["\n  mutation changeLockerStatus($lockerId: ID!, $status: Int) {\n    changeLockerStatus(lockerId: $lockerId, status: $status) {\n      id\n      name\n      status\n      size\n    }\n  }\n"]);return O=function(){return e},e}function S(){var e=Object(v.a)(["\n  query lockers {\n    lockers {\n      id\n      name\n      status\n      size\n    }\n  }\n"]);return S=function(){return e},e}var j=k()(S()),C=(k()(O()),k()(w())),L=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={amount:0,modal:!1,coins:[1e3,500,100,50,20,10,5,2,1],points:new Array(8),locker:{},curTime:0,seconds:0,minutes:0,pay:60,changeamount:0,totalSeconds:0,refreshIntervalId:""},n.handleCickReserveLocker=n.handleCickReserveLocker.bind(Object(g.a)(Object(g.a)(n))),n.disableModal=n.disableModal.bind(Object(g.a)(Object(g.a)(n))),n.insertCoin=n.insertCoin.bind(Object(g.a)(Object(g.a)(n))),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.state.refreshIntervalId=setInterval(function(){e.setState({curTime:e.state.totalSeconds++,minutes:Math.floor(e.state.curTime/60)})},1e3),console.log(this.state.curTime)}},{key:"handleCickReserveLocker",value:function(e){if(this.setState({modal:!0}),this.setState({locker:e}),console.log(e.status),0==e.status){var t={query:'\n          query {\n            locker(id: "'.concat(e.id,'") {\n              id\n              name\n              status\n              size\n            }\n          }\n        ')};this.state.isLogin||(t={query:'\n            mutation {\n              changeLockerStatus({lockerId: "'.concat(e.id,'", status:1}) {\n                email\n              }\n            }\n          ')}),fetch("http://localhost:4000/graphql",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(e){console.log(e)}).catch(function(e){console.log(e)})}}},{key:"handleCheckoutLocker",value:function(e){}},{key:"disableModal",value:function(){this.setState({modal:!1})}},{key:"insertCoin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;console.log(e);var t=this.state.amount;this.setState({amount:t+e})}},{key:"clear",value:function(){this.setState({amount:0}),this.setState({changeamount:0})}},{key:"reserved",value:function(e,t){this.state.changeamount=e-this.state.pay,this.setState({changeamount:e-this.state.pay});var n,a=new Array(10);for(n=0;n<a.length;n++)a[n]=this.state.changeamount/this.state.coins[n],a[n]=Math.floor(a[n]),this.state.changeamount=this.state.changeamount-a[n]*this.state.coins[n];alert("_1000: "+a[0]+"\r\n_500: "+a[1]+"\r\n_100: "+a[2]+"\r\n_50: "+a[3]+"\r\n_20: "+a[4]+"\r\n_10: "+a[5]+"\r\n_5: "+a[6]+"\r\n_2: "+a[7]+"\r\n_1: "+a[8]+"\r\n")}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(i.Query,{query:j},function(t){var n=t.loading,a=t.data,o=b.a.chunk(a.lockers,3);return!n&&r.a.createElement(d.c,null,r.a.createElement(d.i,null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"S"),r.a.createElement("th",null,"M"),r.a.createElement("th",null,"L"))),r.a.createElement("tbody",null,o.map(function(t,n){return r.a.createElement("tr",{key:n},t.map(function(t,n){return r.a.createElement("td",{key:n},0==t.status?r.a.createElement(d.a,{onClick:function(){e.handleCickReserveLocker(t,e.state.curTime)},color:"primary"},"Aviable"):void 0,1==t.status?r.a.createElement(d.a,{onClick:function(){e.handleCickReserveLocker(t,e.state.curTime)},color:"warning"},"Pending"):void 0,2==t.status?r.a.createElement(d.a,{color:"danger"},"Reserved"):void 0)}))}))),r.a.createElement(d.d,{isOpen:e.state.modal,toggle:e.toggle},r.a.createElement(i.Query,{query:C,variables:{input:e.state.locker.size}},function(t){var n=t.loading,a=t.data.size;return!n&&r.a.createElement("div",null,r.a.createElement(d.g,{toggle:e.toggle},"Reserve Pay : ",e.state.pay," "," -- ","Use Coin : ",e.state.amount," "),r.a.createElement(d.e,null,r.a.createElement("h4",null,"minutes : ",e.state.minutes," seconds :"," ",e.state.curTime,r.a.createElement("div",{className:"float-right"},r.a.createElement(d.a,{onClick:function(){return e.clear()}},"clear"))),r.a.createElement("p",null,"Charge coin:",e.state.changeamount),r.a.createElement("p",null,"You are using ",e.state.locker.name),r.a.createElement("p",null,"Price: ",a.price," THB per hour | next minute : ",a.nextMinute," THB per minute"),r.a.createElement("p",null,"Please insert coin:"),r.a.createElement(d.h,null,e.state.coins.map(function(t,n){return r.a.createElement(d.b,{key:n,md:4,className:"mt-3 text-center"},r.a.createElement(d.a,{key:n,color:"primary",onClick:function(){return e.insertCoin(t)}},t))}))),r.a.createElement(d.f,null,r.a.createElement(d.a,{color:"primary",disabled:e.state.amount<a.price,onClick:function(){return e.reserved(e.state.amount,e.state.locker,e.state.curTime)}},"Reserve")," ",r.a.createElement(d.a,{color:"secondary",onClick:e.disableModal},"Cancel")))})))}))}}]),t}(a.Component),I=n(28),M=n.n(I),T=n(49),q=(n(120),function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={isLogin:!0,loginData:null},n.switchModeHandler=function(){n.setState(function(e){return{isLogin:!e.isLogin}})},n.logout=function(){n.setState({loginData:null}),localStorage.clear()},n.submitHandler=function(e){e.preventDefault();var t=n.emailEl.current.value,a=n.passwordEl.current.value;if(0!==t.trim().length&&0!==a.trim().length){var r={query:'\n        query {\n          login(email: "'.concat(t,'", password: "').concat(a,'") {\n            userId\n            token\n            tokenExpiration\n          }\n        }\n      ')};n.state.isLogin||(r={query:'\n          mutation {\n            createUser(usersInput: {email: "'.concat(t,'", password: "').concat(a,'"}) {\n              email\n            }\n          }\n        ')}),fetch("http://localhost:4000/graphql",{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}}).then(function(e){if(200!==e.status&&201!==e.status)throw new Error("Failed!");return e.json()}).then(function(){var e=Object(T.a)(M.a.mark(function e(t){return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({loginData:t.data}),e.next=3,localStorage.setItem("login",JSON.stringify(t.data));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){console.log(e)})}},n.emailEl=r.a.createRef(),n.passwordEl=r.a.createRef(),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=Object(T.a)(M.a.mark(function e(){var t;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,JSON.parse(localStorage.getItem("login"));case 2:t=e.sent,this.setState({loginData:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.loginData;return e?r.a.createElement("p",null,e.login.userId," ",r.a.createElement("button",{type:"button",onClick:this.logout},"Logout")):r.a.createElement("form",{className:"auth-form",onSubmit:this.submitHandler},r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"email"},"E-Mail"),r.a.createElement("input",{className:"form-control",type:"email",id:"email",ref:this.emailEl})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{className:"form-control",type:"password",id:"password",ref:this.passwordEl})),r.a.createElement("div",{className:"form-actions"},r.a.createElement("button",{type:"submit"},"Submit"),r.a.createElement("button",{type:"button",onClick:this.switchModeHandler},"Switch to ",this.state.isLogin?"Signup":"Login")))}}]),t}(a.Component)),N=function(e){return r.a.createElement("header",{className:"main-navigation"},r.a.createElement("div",{className:"main-navigation__logo"},r.a.createElement("h1",null,"Lockers")),r.a.createElement("nav",{className:"main-navigation__items"},r.a.createElement("li",null,r.a.createElement(f.b,{to:"/auth"},"Authenticate"))))},_=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state={editing:null},n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;this.state.editing;return r.a.createElement(d.c,null,r.a.createElement(f.a,null,r.a.createElement(N,null),r.a.createElement(p.d,null,r.a.createElement(p.a,{from:"/",to:"/auth",exact:!0}),r.a.createElement(p.b,{path:"/auth",component:q}))),r.a.createElement(L,{canEdit:function(){return!0},onEdit:function(t){return e.setState({editing:t})}}))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var x=new(n(71).a)({uri:"http://localhost:4000/graphql"});c.a.render(r.a.createElement(i.ApolloProvider,{client:x},r.a.createElement(_,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},73:function(e,t,n){e.exports=n(132)}},[[73,1,2]]]);
//# sourceMappingURL=main.43be7fad.chunk.js.map